<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Valentine</title>

  <style>
    :root{
      --pink:#ff2f7b;
      --pink2:#ff78b3;
      --bg1:#ffe6ef;
      --bg2:#ffd1e2;
      --card:#ffffffee;
      --text:#1b1b1b;
      --shadow: 0 20px 40px rgba(0,0,0,.18);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; overscroll-behavior:auto; }

    /* Scroll limit√©: seulement vertical, et seulement un peu */
    body{
      margin:0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(1200px 700px at 15% 10%, #fff 0%, var(--bg1) 35%, var(--bg2) 100%);
      color:var(--text);
      overflow-x:hidden;
      overflow-y:auto;
    }

    /* On garde la carte toujours visible */
    .ui{
      position: sticky;
      top: 0;
      z-index: 20;
      display:grid;
      place-items:center;
      padding: 18px 16px 10px;
      pointer-events:none; /* la carte ne bloque pas la poursuite */
    }

    .card{
      width:min(520px, 92vw);
      background:var(--card);
      border-radius:26px;
      padding:26px 18px 22px;
      box-shadow: var(--shadow);
      text-align:center;
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,.6);
      pointer-events:auto; /* mais les boutons restent cliquables */
    }

    .icon{
      width:86px;
      height:86px;
      margin: 0 auto 14px;
      border-radius:50%;
      background:#fff;
      display:grid;
      place-items:center;
      box-shadow: 0 12px 26px rgba(0,0,0,.14);
      font-size:34px;
      user-select:none;
    }

    h1{
      font-size:22px;
      margin: 10px 0 16px;
      line-height:1.25;
    }

    .hint{
      font-size:12px;
      opacity:.65;
      margin-top:12px;
      user-select:none;
    }

    .buttons{
      position:relative;
      height:88px;
      margin: 10px 0 0;
    }

    button{
      border:none;
      border-radius:999px;
      padding: 14px 26px;
      font-size:18px;
      font-weight:800;
      cursor:pointer;
      box-shadow: 0 10px 22px rgba(0,0,0,.14);
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }

    .yes{
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      color:#fff;
    }

    /* Le terrain est seulement un peu plus grand que l'√©cran (pas gigantesque) */
    .arena{
      position:relative;
      width: 100vw;
      height: 160vh;            /* scroll limit√© */
      min-height: 1200px;       /* pour √©viter trop petit sur grand √©cran */
    }

    /* Donuts d√©coratifs (fixed) */
    .donut{
      position:fixed;
      width:92px;
      height:92px;
      border-radius:50%;
      background:
        radial-gradient(circle at 50% 50%, transparent 0 33%, rgba(255,255,255,.0) 33% 34%, transparent 34% 100%),
        radial-gradient(circle at 35% 35%, rgba(255,255,255,.8) 0 12%, rgba(255,255,255,0) 13% 100%),
        radial-gradient(circle at 50% 45%, #ffb6d3 0 58%, #ff5aa6 59% 100%);
      box-shadow: 0 18px 35px rgba(0,0,0,.14);
      transform: rotate(var(--rot));
      opacity:.95;
      pointer-events:none;
      z-index:1;
    }
    .donut::before{
      content:"";
      position:absolute;
      inset:10px;
      border-radius:50%;
      background: radial-gradient(circle at 50% 50%, #fff 0 33%, transparent 34% 100%);
      box-shadow: inset 0 0 0 12px rgba(255,255,255,.55);
    }
    .d1{ left:14px; top:24px; --rot:18deg; }
    .d2{ right:18px; top:46px; --rot:-12deg; width:78px; height:78px; }
    .d3{ left:24px; bottom:32px; --rot:-22deg; width:84px; height:84px; }
    .d4{ right:10px; bottom:18px; --rot:10deg; width:104px; height:104px; }

    .sprinkles{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:0;
      opacity:.55;
      background:
        radial-gradient(circle at 12% 22%, rgba(255,47,123,.25) 0 2px, transparent 3px),
        radial-gradient(circle at 80% 18%, rgba(255,120,179,.25) 0 2px, transparent 3px),
        radial-gradient(circle at 65% 72%, rgba(255,47,123,.22) 0 2px, transparent 3px),
        radial-gradient(circle at 30% 78%, rgba(255,120,179,.22) 0 2px, transparent 3px);
      background-size: 220px 220px;
    }

    /* Le bouton Non vit dans le document (scroll), mais dans une zone limit√©e */
    .no{
      position:absolute;
      left: 56vw;
      top: 92vh;
      background:#ededed;
      color:#333;
      z-index:10;
      touch-action:none;
      will-change:left, top, transform;
    }

    .result{
      display:none;
      margin-top:16px;
    }

    .yay{
      font-size:26px;
      font-weight:900;
      margin-bottom:10px;
    }

    .message{
      font-size:28px;
      font-weight:900;
      margin: 6px 0 14px;
      color: var(--pink);
    }

    .photo{
      width:100%;
      max-height: 52vh;
      object-fit: contain;
      border-radius:18px;
      display:block;
      margin: 0 auto;
      box-shadow: 0 14px 30px rgba(0,0,0,.14);
    }

    canvas{
      position:fixed;
      inset:0;
      pointer-events:none;
      display:none;
      z-index:30;
    }
  </style>
</head>

<body>
  <div class="sprinkles"></div>
  <div class="donut d1"></div>
  <div class="donut d2"></div>
  <div class="donut d3"></div>
  <div class="donut d4"></div>

  <canvas id="confetti"></canvas>

  <div class="ui">
    <div class="card">
      <div class="icon">üç©üíò</div>
      <h1>Sarah, veux-tu √™tre ma Valentine&nbsp;?</h1>

      <div class="buttons" id="buttons">
        <button class="yes" id="yes">Oui</button>
      </div>

      <div class="hint" id="hint">Le ¬´ Non ¬ª est en fuite.</div>

      <div class="result" id="result">
        <div class="yay">VAMOOOOOOOOOS</div>
        <div class="message">Dieu merci</div>
        <img src="photo.jpg" class="photo" alt="Photo" />
      </div>
    </div>
  </div>

  <div class="arena" id="arena">
    <button class="no" id="no">Non</button>
  </div>

  <script>
    const arena = document.getElementById("arena");
    const no = document.getElementById("no");
    const yes = document.getElementById("yes");
    const result = document.getElementById("result");
    const buttons = document.getElementById("buttons");
    const hint = document.getElementById("hint");

    // ---- Course poursuite (pas de t√©l√©portation), zone limit√©e ----
    let pos = { x: no.offsetLeft, y: no.offsetTop };
    let vel = { x: 0, y: 0 };
    let pointer = { x: pos.x, y: pos.y };
    let lastT = performance.now();

    // R√©glages
    const margin = 14;

    const fleeRadius = 220;
    const fearGain = 1.9;
    const baseAccel = 0.36;
    const friction = 0.90;
    const maxSpeed = 9.0;

    const minSpeed = 1.15;
    const idleWander = 0.05;

    const trembleRadius = 90;
    const trembleForce = 0.55;

    const curveStrength = 0.75;
    const curveNoise = 0.35;

    const edgeAvoidDist = 110;
    const edgeAvoidForce = 0.62;

    function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }
    function hypot(x,y){ return Math.hypot(x,y); }

    function getBounds(){
      // Zone = arena (pas le body entier)
      const r = arena.getBoundingClientRect();
      const w = arena.scrollWidth;
      const h = arena.scrollHeight;
      return { w, h };
    }

    function updatePointer(e){
      // Coordonn√©es DANS LE DOCUMENT (scroll inclus)
      pointer.x = e.clientX + window.scrollX;
      pointer.y = e.clientY + window.scrollY;
    }

    window.addEventListener("pointermove", updatePointer, { passive:true });

    no.addEventListener("pointerdown", (e) => {
      e.preventDefault();
      updatePointer(e);
    });
    no.addEventListener("click", (e) => e.preventDefault());

    function step(now){
      const dt = clamp((now - lastT) / 16.666, 0.5, 2.0);
      lastT = now;

      const rect = no.getBoundingClientRect();
      const w = rect.width;
      const h = rect.height;

      const cx = pos.x + w/2;
      const cy = pos.y + h/2;

      const dx = cx - pointer.x;
      const dy = cy - pointer.y;
      const d = hypot(dx, dy);

      let ax = 0, ay = 0;

      if (d > fleeRadius * 1.3){
        ax += (Math.random() - 0.5) * idleWander;
        ay += (Math.random() - 0.5) * idleWander;
      }

      if (d < fleeRadius){
        const nx = dx / (d || 1);
        const ny = dy / (d || 1);

        const closeness = 1 - (d / fleeRadius);
        const fear = 1 + fearGain * closeness * closeness;

        ax += nx * baseAccel * fear;
        ay += ny * baseAccel * fear;

        const px = -ny;
        const py = nx;
        const side = (vel.x * px + vel.y * py) >= 0 ? 1 : -1;
        const noise = (Math.random() - 0.5) * curveNoise;
        const curve = (curveStrength * (0.35 + closeness) + noise) * side;

        ax += px * curve;
        ay += py * curve;

        if (d < trembleRadius){
          const t = (1 - d / trembleRadius);
          ax += (Math.random() - 0.5) * trembleForce * (0.4 + 1.2*t);
          ay += (Math.random() - 0.5) * trembleForce * (0.4 + 1.2*t);
        }
      }

      const B = getBounds();
      const left = pos.x;
      const top = pos.y;
      const right = (B.w - (pos.x + w));
      const bottom = (B.h - (pos.y + h));

      if (left < edgeAvoidDist)  ax += edgeAvoidForce * (1 - left/edgeAvoidDist);
      if (right < edgeAvoidDist) ax -= edgeAvoidForce * (1 - right/edgeAvoidDist);
      if (top < edgeAvoidDist)   ay += edgeAvoidForce * (1 - top/edgeAvoidDist);
      if (bottom < edgeAvoidDist)ay -= edgeAvoidForce * (1 - bottom/edgeAvoidDist);

      vel.x = (vel.x + ax * dt) * Math.pow(friction, dt);
      vel.y = (vel.y + ay * dt) * Math.pow(friction, dt);

      const sp = hypot(vel.x, vel.y);
      if (sp < minSpeed){
        const rx = sp > 0.001 ? vel.x / sp : (Math.random() - 0.5);
        const ry = sp > 0.001 ? vel.y / sp : (Math.random() - 0.5);
        vel.x += rx * (minSpeed - sp) * 0.25;
        vel.y += ry * (minSpeed - sp) * 0.25;
      }

      const sp2 = hypot(vel.x, vel.y);
      if (sp2 > maxSpeed){
        vel.x = (vel.x / sp2) * maxSpeed;
        vel.y = (vel.y / sp2) * maxSpeed;
      }

      pos.x += vel.x * dt;
      pos.y += vel.y * dt;

      pos.x = clamp(pos.x, margin, B.w - w - margin);
      pos.y = clamp(pos.y, margin, B.h - h - margin);

      no.style.left = pos.x + "px";
      no.style.top  = pos.y + "px";

      requestAnimationFrame(step);
    }

    requestAnimationFrame(step);

    // ---- Confetti ----
    const canvas = document.getElementById("confetti");
    const ctx = canvas.getContext("2d");
    let confetti = [];

    function resizeCanvas(){
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);

    function startConfetti(){
      canvas.style.display = "block";
      confetti = Array.from({ length: 190 }, () => ({
        x: Math.random() * canvas.width,
        y: -20 - Math.random() * 200,
        w: 4 + Math.random() * 8,
        h: 4 + Math.random() * 10,
        vy: 2.5 + Math.random() * 4.5,
        vx: -1 + Math.random() * 2,
        c: ["#ff2f7b", "#ff78b3", "#ffd1e2", "#ffffff"][Math.floor(Math.random() * 4)],
        rot: Math.random() * Math.PI,
        vr: -0.15 + Math.random() * 0.3
      }));

      let t = 0;
      function draw(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        confetti.forEach(p => {
          p.x += p.vx;
          p.y += p.vy;
          p.rot += p.vr;

          ctx.save();
          ctx.translate(p.x, p.y);
          ctx.rotate(p.rot);
          ctx.fillStyle = p.c;
          ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
          ctx.restore();

          if (p.y > canvas.height + 30){
            p.y = -30;
            p.x = Math.random() * canvas.width;
          }
        });
        t++;
        if (t < 220) requestAnimationFrame(draw);
        else canvas.style.display = "none";
      }
      draw();
    }

    yes.addEventListener("click", () => {
      buttons.style.display = "none";
      no.style.display = "none";
      hint.style.display = "none";
      result.style.display = "block";
      startConfetti();
    });
  </script>
</body>
</html>
